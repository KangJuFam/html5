<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ì–‘ì´ vs. ë§¤í™”ê²€</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        canvas {
            display: block;
            background-color: #f0f0f0;
        }
        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: black;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            display: none; /* ê²Œì„ ì‹œì‘ ì „ì—ëŠ” ìˆ¨ê¹€ */
        }
        /* ì‹œì‘ ë° ê²Œì„ ì˜¤ë²„ í™”ë©´ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .overlay h1 {
            font-size: 3em;
            margin-bottom: 20px;
        }
        .overlay p {
            font-size: 1.5em;
            margin: 10px 0;
        }
        .overlay button {
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: #4CAF50;
            color: white;
            margin-top: 20px;
            font-weight: bold;
        }
        .overlay .button-group {
            margin-top: 20px;
        }
        .overlay .button-group button {
            margin: 0 10px;
        }
        #startScreen {
            display: flex; /* ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì´ê²Œ ì„¤ì • */
        }
        #gameOverScreen {
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        }
    </style>
</head>
<body>
    <div id="score">ìƒì¡´ ì‹œê°„: 0ì´ˆ</div>

    <div id="startScreen" class="overlay">
        <h1>ê³ ì–‘ì´ vs. ë§¤í™”ê²€ ğŸŒ¸</h1>
        <p>í‚¤ë³´ë“œ ë°©í–¥í‚¤ ë˜ëŠ” ë“œë˜ê·¸ë¡œ ê³ ì–‘ì´ë¥¼ ì¡°ì¢…í•˜ì—¬<br>ë‚ ì•„ì˜¤ëŠ” ë§¤í™”ê²€ì„ í”¼í•˜ì„¸ìš”!</p>
        <button id="startButton">ê²Œì„ ì‹œì‘</button>
    </div>

    <div id="gameOverScreen" class="overlay">
        <h1>ê²Œì„ ì˜¤ë²„! ğŸ±ğŸ’€</h1>
        <p id="finalTitle"></p>
        <p id="finalScore"></p>
        <div class="button-group">
            <button id="restartButton">ë‹¤ì‹œí•˜ê¸°</button>
            <button id="shareButton">ìë‘í•˜ê¸°</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreElement = document.getElementById("score");
        const startScreen = document.getElementById("startScreen");
        const gameOverScreen = document.getElementById("gameOverScreen");
        const startButton = document.getElementById("startButton");
        const restartButton = document.getElementById("restartButton");
        const shareButton = document.getElementById("shareButton");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- ê²Œì„ ìƒíƒœ ë³€ìˆ˜ (ì „ì—­ìœ¼ë¡œ ì´ë™) ---
        let catX, catY;
        let speed = 5;
        let keys = {};
        let isDragging = false;
        let swords = [];
        let gameTime = 0;
        let spawnRate;
        let additionalSwords;
        let isGameOver = true; // ì²˜ìŒì—” ê²Œì„ì´ ë©ˆì¶˜ ìƒíƒœ
        let startTime = null;

        // --- ê²Œì„ í•µì‹¬ í•¨ìˆ˜ë“¤ ---

        function getTitle(time) {
            if (time < 20) return "ì´ˆë³´ ê³ ì–‘ì´";
            if (time < 40) return "ê³ ì–‘ì´ í˜‘ê°";
            if (time < 60) return "ë§¤í™”ê²€ì˜ ë‹¬ì¸";
            return "ì „ì„¤ì˜ ë¬´ë¦¼ë¬˜";
        }
        
        // ê²Œì„ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ê³  ì‹œì‘í•˜ëŠ” í•¨ìˆ˜
        function startGame() {
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
            catX = canvas.width / 2 - 12.5;
            catY = canvas.height / 2 - 12.5;
            swords = [];
            gameTime = 0;
            spawnRate = 1000;
            additionalSwords = 0;
            isGameOver = false;
            startTime = null;

            // í™”ë©´ ì „í™˜
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            scoreElement.style.display = 'block';
            
            // ê²Œì„ ë£¨í”„ ì‹œì‘
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            isGameOver = true;
            document.getElementById("finalTitle").innerText = "ì¹­í˜¸: " + getTitle(gameTime);
            document.getElementById("finalScore").innerText = "ìƒì¡´ ì‹œê°„: " + gameTime + "ì´ˆ";
            gameOverScreen.style.display = 'flex';
            scoreElement.style.display = 'none';
        }

        function moveCat() {
            if (keys["ArrowLeft"] && catX > 0) catX -= speed;
            if (keys["ArrowRight"] && catX < canvas.width - 25) catX += speed;
            if (keys["ArrowUp"] && catY > 0) catY -= speed;
            if (keys["ArrowDown"] && catY < canvas.height - 25) catY += speed;
        }

        function createSword() {
            let side = Math.floor(Math.random() * 4);
            let x, y;
            if (side === 0) { x = Math.random() * canvas.width; y = -10; }
            else if (side === 1) { x = Math.random() * canvas.width; y = canvas.height + 10; }
            else if (side === 2) { x = -10; y = Math.random() * canvas.height; }
            else { x = canvas.width + 10; y = Math.random() * canvas.height; }

            let angle = Math.atan2(catY + 12.5 - y, catX + 12.5 - x);
            let acceleration = gameTime > 30 ? 0.2 : 0.1;
            let swordSpeed = Math.min(2 + gameTime * acceleration, 10);
            swords.push({ x, y, angle, speed: swordSpeed });
        }

        function updateSwords() {
            swords = swords.filter(sword => {
                sword.x += Math.cos(sword.angle) * sword.speed;
                sword.y += Math.sin(sword.angle) * sword.speed;
                return sword.x >= -10 && sword.x <= canvas.width + 10 &&
                       sword.y >= -10 && sword.y <= canvas.height + 10;
            });
        }

        function drawSwords() {
            ctx.font = "15px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            swords.forEach(sword => ctx.fillText("ğŸŒ¸", sword.x, sword.y));
        }

        function checkCollision() {
            for (const sword of swords) {
                let dx = sword.x - (catX + 12.5);
                let dy = sword.y - (catY + 12.5);
                let distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < 18) {
                    gameOver();
                    break;
                }
            }
        }

        function updateScore() {
            scoreElement.innerText = "ìƒì¡´ ì‹œê°„: " + gameTime + "ì´ˆ";
        }
        
        let lastSpawnTime = 0;

        function gameLoop(timestamp) {
            if (isGameOver) return;
            if (!startTime) startTime = timestamp;

            // ì‹œê°„ ë° ë‚œì´ë„ ì—…ë°ì´íŠ¸
            let elapsedSeconds = Math.floor((timestamp - startTime) / 1000);
            if (elapsedSeconds > gameTime) {
                gameTime = elapsedSeconds;
                if (gameTime > 0 && gameTime % 5 === 0) {
                    spawnRate = Math.max(spawnRate - 100, 300);
                    additionalSwords = Math.min(additionalSwords + 1, 20);
                }
            }
            
            // ê²€ê¸° ìƒì„±
            if (timestamp - lastSpawnTime > spawnRate) {
                createSword();
                for (let i = 0; i < additionalSwords; i++) createSword();
                lastSpawnTime = timestamp;
            }

            // ê·¸ë¦¬ê¸° ë° ì—…ë°ì´íŠ¸
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            moveCat();
            updateSwords();
            drawSwords();
            updateScore();
            
            ctx.font = "25px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("ğŸ±", catX + 12.5, catY + 12.5);

            // ì¶©ëŒ ê°ì§€ëŠ” ë§ˆì§€ë§‰ì—
            checkCollision();

            requestAnimationFrame(gameLoop);
        }
        
        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (í•œ ë²ˆë§Œ ë“±ë¡) ---
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame); // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ë„ startGame í˜¸ì¶œ

        shareButton.addEventListener('click', () => {
            const title = getTitle(gameTime);
            const textToCopy = `${title} ì¹­í˜¸ë¥¼ ì–»ì—ˆë‹¤! (ìƒì¡´ ì‹œê°„: ${gameTime}ì´ˆ) www.abc.com`;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                shareButton.innerText = 'ë³µì‚¬ ì™„ë£Œ!';
                setTimeout(() => {
                    shareButton.innerText = 'ìë‘í•˜ê¸°';
                }, 1500);
            }).catch(err => {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        });

        window.addEventListener("keydown", (event) => {
            keys[event.key] = true;
            if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight", " "].includes(event.key)) {
                event.preventDefault();
            }
        });

        window.addEventListener("keyup", (event) => {
            keys[event.key] = false;
        });

        canvas.addEventListener("mousedown", (event) => {
            if (isGameOver) return;
            if (event.clientX >= catX && event.clientX <= catX + 25 &&
                event.clientY >= catY && event.clientY <= catY + 25) {
                isDragging = true;
            }
        });

        canvas.addEventListener("mousemove", (event) => {
            if (isDragging) {
                catX = event.clientX - 12.5;
                catY = event.clientY - 12.5;
            }
        });

        canvas.addEventListener("mouseup", () => { isDragging = false; });
        canvas.addEventListener("mouseleave", () => { isDragging = false; });

        canvas.addEventListener("touchstart", (event) => {
            if (isGameOver) return;
            let touch = event.touches[0];
            if (touch.clientX >= catX && touch.clientX <= catX + 25 &&
                touch.clientY >= catY && touch.clientY <= catY + 25) {
                isDragging = true;
            }
        }, { passive: false });

        canvas.addEventListener("touchmove", (event) => {
            if (!isDragging) return;
            event.preventDefault();
            let touch = event.touches[0];
            catX = touch.clientX - 12.5;
            catY = touch.clientY - 12.5;
        }, { passive: false });

        canvas.addEventListener("touchend", () => { isDragging = false; });

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            // ê²Œì„ì´ ì§„í–‰ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ê³ ì–‘ì´ ìœ„ì¹˜ë¥¼ ì¬ì¡°ì •
            if (isGameOver) {
                catX = canvas.width / 2 - 12.5;
                catY = canvas.height / 2 - 12.5;
            }
        });
    </script>
</body>
</html>
